name: Weekly Flair

on:
  schedule:
    - cron: "10 0 * * 1"   # Lunes 00:10 UTC (ajusta si quieres otra hora)
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install praw tzdata

      # PASO A) Chequeo previo: verifica que EXISTEN los secrets requeridos
      - name: Check env (no secrets values)
        run: |
          test -n "${{ secrets.REDDIT_CLIENT_ID }}" && echo "OK: REDDIT_CLIENT_ID" || (echo "MISSING: REDDIT_CLIENT_ID" && exit 1)
          test -n "${{ secrets.REDDIT_CLIENT_SECRET }}" && echo "OK: REDDIT_CLIENT_SECRET" || (echo "MISSING: REDDIT_CLIENT_SECRET" && exit 1)
          test -n "${{ secrets.REDDIT_USERNAME }}" && echo "OK: REDDIT_USERNAME" || (echo "MISSING: REDDIT_USERNAME" && exit 1)
          test -n "${{ secrets.REDDIT_PASSWORD }}" && echo "OK: REDDIT_PASSWORD" || (echo "MISSING: REDDIT_PASSWORD" && exit 1)

      - name: Run bot
        env:
          SUBREDDIT: RoccoSiffrediPorn
          DRY_RUN: "true"                                  # Cambia a "false" cuando verifiques
          REDDIT_CLIENT_ID: ${{ secrets.REDDIT_CLIENT_ID }}
          REDDIT_CLIENT_SECRET: ${{ secrets.REDDIT_CLIENT_SECRET }}
          REDDIT_USERNAME: ${{ secrets.REDDIT_USERNAME }}  # WeeklyFlairBot
          REDDIT_PASSWORD: ${{ secrets.REDDIT_PASSWORD }}
          REDDIT_USER_AGENT: "weekly-flair-bot by u/WeeklyFlairBot v1"
        run: python weekly_flair_bot.py
